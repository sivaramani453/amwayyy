{
    "variables": {
      "aws_access_key": "",
      "aws_secret_key": "",
      "snapshot_id": "{{env `SNAPSHOT_ID`}}",
      "volume_name": "{{env `VOLUME_NAME`}}",
      "availability_zone": "{{env `AZ`}}"
    },
    "builders": [{
        "type" : "amazon-ebsvolume",
        "secret_key" : "{{user `aws_access_key`}}",
        "access_key" : "{{user `aws_secret_key`}}",
        "region" : "eu-central-1",
        "availability_zone" : "{{user `availability_zone`}}",
        "ssh_username" : "centos",
        "instance_type" : "t3.xlarge",
        "source_ami_filter": {
            "filters": {
            "virtualization-type": "hvm",
            "name": "db-instance*",
            "root-device-type": "ebs"
            },
            "owners": ["860702706577"],
            "most_recent": true
          },
        "vpc_filter": {
            "filters": {
                "tag:Name": "AWS-EIA-Hybris",
                "isDefault": "false"
            }
        },
        "subnet_filter": {
            "filters": {
              "availabilityZone": "{{user `availability_zone`}}"
            },
            "most_free": true
        },
        "ebs_volumes" : [{
            "volume_type" : "gp3",
            "snapshot_id" : "{{user `snapshot_id`}}",
            "device_name" : "/dev/xvdf",
            "delete_on_termination" : false,
            "tags" : {
                "Name" : "{{user `volume_name`}}",
                "AWS_DEPLOING" : "daily"
            }
        }]
    }],
    "provisioners": [
        {
            "type": "shell",
            "script": "db_movement.sh"
        }
    ]
}

