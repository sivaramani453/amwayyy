---
# Apply common configuration
- hosts: "all"
  remote_user: "centos"
# Just to make things easy
  pre_tasks:
    - name: Check vault integartion in really stupid way
      fail:
        msg: "Variabled supposed to be obtained from vault is emty"
      when:
        - AWS_RW_PARAMETER_STORE_KEY_ID is undefined or ( AWS_RW_PARAMETER_STORE_KEY_ID | length ) == 0

    - name: Disable Selinux
      become: True
      selinux:
        state: "disabled"
        
  vars:
    bamboo_agent_user: "bamboo"
    bamboo_agent_group: "bamboo"      
    bamboo_agent_application_folder: "/var/bamboo-agent"      

  roles:
  - role: '../roles/lean_delivery.java'
    java_package: jdk
    transport: "web"
    transport_web: "https://nexus.hybris.eia.amway.net/repository/static-files/static-dev/jdk-8u131-linux-x64.tar.gz"
    tags:
      - java

  - role: '../roles/gantsign.maven'
    maven_version: '3.2.5'
    tags:
      - java
      
  - role: '../roles/bamboo-agent'
    become: True
    bamboo_agent_spot: True
    bamboo_agent_remote: True
    bamboo_cert_url: "amway-prod.tt.com.pl/bamboo"
    bamboo_master_url: "https://amway-prod.tt.com.pl/bamboo"
    bamboo_master_version: "6.6.3"
    bamboo_agent_data_folder: "/var/bamboo-agent"
    bamboo_agent_jvm_xms: "512"
    bamboo_agent_jvm_xmx: "1024"
    bamboo_agent_start_timeout: "1440"
    bamboo_agent_timezone: "Europe/Warsaw"
    bamboo_java_home: "/usr/java/jdk1.8.0_131"
    tags:
      - bamboo
      
  - role: '../roles/ci-autotest-prepare'
    become: True
    tags:
      - bamboo
