---
# Apply common configuration
- hosts: all
  vars:
    docker_container_size: "20G"
  remote_user: root
# Just to make things easy
  pre_tasks:
    - name: "Disable Selinux"
      become: True
      selinux:
        state: "disabled"

  roles:
  - { role: '../roles/lean_delivery.docker' }

  post_tasks:
    - name: "Install docker-compose"
      become: True
      get_url:
        url: "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}"
        dest: "/usr/bin/docker-compose"
        mode: 755

    - name: "Create .docker directory"
      become: True
      file: 
        path: "/root/.docker" 
        state: "directory"

    - name: "Loggin to docker repo"
      become: True
      template:
        src: "config.json.j2"
        dest: "/root/.docker/config.json"
        mode: 600

    - name: "Set container size"
      become: True
      template:
        src: "daemon.json.j2"
        dest: "/etc/docker/daemon.json"

    - name: "Install git" 
      become: True
      package: 
        name: "{{ item }}"
        state: "present"
      loop:
        - git
        - NetworkManager    

