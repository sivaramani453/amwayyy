---
- name: Prepare EC2 Instance
  hosts: postgresql

  pre_tasks:
    - name: Provision additional disk for PostgreSQL
      include_tasks: postgresql-data-disk.yml

  roles:
    - role: "./roles/lean_delivery.docker"
  become: True

  post_tasks:
    - name: Configure docker and launch database container
      include_tasks: postgresql-docker-container.yml

    - name: Configure EFS
      include_tasks: postgresql-efs-archive.yml
      when: (archive_efs_mountpoint_src is defined) and (archive_efs_mountpoint_src|length > 0) 
