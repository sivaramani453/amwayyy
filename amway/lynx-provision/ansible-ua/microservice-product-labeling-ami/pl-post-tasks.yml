---
- name: Enable and Install additional repositories and packages
  block:
    - name: Enable repositories
      yum:
        name: '{{ item }}'
        state: present
      loop: '{{ repo_urls }}'  
  
    - name: Install system packages
      yum:
        name: '{{ item }}'
        state: present
      loop: '{{ system_packages }}'

    - name: Install pip packages
      pip:
        name: '{{ item }}'
      loop: '{{ pip_packages }}'
  become: True   

- name: Install docker-compose
  get_url:
    url: '{{ docker_compose_url }}'
    dest: '{{ docker_compose_path }}'
    owner: 'root'
    group: 'root'
    mode: '0755'
    seuser: 'system_u'
    serole: 'object_r'
    setype: 'bin_t'
    selevel: 's0'
  register: docker_compose_downloaded
  until: docker_compose_downloaded is succeeded
  retries: 3
  delay: 2
  become: True  
   
- name: Create docker build directories
  file:
    path: '{{ item }}'
    state: directory
    owner: 'root'
    group: 'root'
    mode: '0755'
  loop: '{{ docker_build_dirs }}'
  become: True
